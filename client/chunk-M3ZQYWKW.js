import{a as Ve}from"./chunk-H2HXXBLD.js";import{a as Re,b as ge,c as qe,d as Be}from"./chunk-UIAJAY4Q.js";import{$ as Le,$a as P,Aa as te,B as E,E as z,Fa as ne,G as Ie,I as d,J as m,K as me,M as b,N as S,O as v,P as i,Q as a,R as x,S as N,Sa as K,T,Ta as j,Y as y,Ya as Fe,Za as M,_ as u,_a as _e,a as R,aa as c,ab as g,b as Ae,bb as D,cb as U,d as ke,db as fe,eb as B,fb as Oe,gb as O,ia as L,ib as G,jb as ie,ka as Pe,kb as ae,la as o,lb as re,ma as k,mb as Ge,na as h,nb as A,o as C,oa as ce,ob as oe,p as _,pa as pe,pb as V,q as f,qa as ue,qb as w,r as W,ra as he,s as Y,u as Z,va as Ue,y as l,ya as ee}from"./chunk-AKGLJKXW.js";function ze(n,t){n&1&&(i(0,"span"),o(1,"Group Name is required."),a())}function Ke(n,t){if(n&1&&(i(0,"span"),o(1),a()),n&2){let e=c(2);l(),h(" Group Name cannot exceed ",e.groupName==null||e.groupName.errors==null||e.groupName.errors.maxlength==null?null:e.groupName.errors.maxlength.requiredLength," characters. ")}}function je(n,t){if(n&1&&(i(0,"div",13),d(1,ze,2,0,"span"),d(2,Ke,2,1,"span"),a()),n&2){let e=c();l(),m(!(e.groupName==null||e.groupName.errors==null)&&e.groupName.errors.required?1:-1),l(),m(!(e.groupName==null||e.groupName.errors==null)&&e.groupName.errors.maxlength?2:-1)}}var Ce=class n{_coreService=C(M);_apiFs=C(w);_fb=C(A);isEditMode=!1;machineGroupData;closeOrCancel=new z;upsert=new z;mgForm=this._fb.group({groupName:["",[g.required,g.maxLength(120)]]});ngOnChanges(t){t.machineGroupData?.currentValue&&(this.isEditMode=!!t.machineGroupData?.currentValue?._id,this.mgForm.patchValue({groupName:this.machineGroupData?.groupName||""}))}get groupName(){return this.mgForm.get("groupName")}isReqAlive=!1;onSubmit(){if(this.isReqAlive)return;if(this.mgForm.invalid){this.mgForm.markAllAsTouched();return}let t={groupName:this.groupName?.value};if(this.isReqAlive=!0,!this.isEditMode)this._apiFs.machineGroup.create(t).subscribe({next:e=>{this.isReqAlive=!1,e.code==="CREATED"&&(this._coreService.utils.showToaster("success","Machine Group created successfully."),this.upsert.emit(!0))},error:e=>{this.isReqAlive=!1;let r=e?.error?.message||"Something went wrong, please try again later.";this._coreService.utils.showToaster("danger",r)}});else{let e=this.machineGroupData?._id;if(!e){this.isReqAlive=!1,this._coreService.utils.showToaster("danger","Machine Group ID is missing.");return}this._apiFs.machineGroup.update(e,t).subscribe({next:r=>{this.isReqAlive=!1,r.code==="OK"&&(this._coreService.utils.showToaster("success","Machine Group updated successfully."),this.upsert.emit(r.data))},error:r=>{this.isReqAlive=!1;let s=r?.error?.message||"Something went wrong, please try again later.";this._coreService.utils.showToaster("danger",s)}})}}onCloseOrCancel(){this.closeOrCancel.emit()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=E({type:n,selectors:[["app-upsert-machine-group"]],inputs:{machineGroupData:"machineGroupData"},outputs:{closeOrCancel:"close",upsert:"upsert"},features:[Z],decls:22,vars:4,consts:[[1,"modal","d-block"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content","shadow-lg"],[3,"ngSubmit","formGroup"],[1,"modal-header"],[1,"modal-title","fs-5"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"row"],[1,"col-12","mb-3"],["for","groupName",1,"form-label"],[1,"text-danger"],["type","text","id","groupName","formControlName","groupName","placeholder","Enter Group Name",1,"form-control"],[1,"invalid-feedback","d-block"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary","me-3",3,"click"],[1,"btn","btn-primary"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3),u("ngSubmit",function(){return r.onSubmit()}),i(4,"div",4)(5,"h1",5),o(6),a(),i(7,"button",6),u("click",function(){return r.onCloseOrCancel()}),a()(),i(8,"div",7)(9,"div",8)(10,"div",9)(11,"label",10),o(12," Group Name "),i(13,"span",11),o(14,"*"),a()(),x(15,"input",12),d(16,je,3,2,"div",13),a()()(),i(17,"div",14)(18,"button",15),u("click",function(){return r.onCloseOrCancel()}),o(19," Cancel "),a(),i(20,"button",16),o(21),a()()()()()()),e&2&&(l(3),v("formGroup",r.mgForm),l(3),h(" ",r.isEditMode?"Edit ":"Create ","Machine Group "),l(10),m(r.groupName!=null&&r.groupName.touched&&(r.groupName!=null&&r.groupName.errors)?16:-1),l(5),h(" ",r.isEditMode?"Update":"Create"," "))},dependencies:[V,B,P,D,U,O,G],encapsulation:2})};var He=(n,t)=>t._id;function Je(n,t){if(n&1){let e=y();i(0,"tr")(1,"th",14),o(2),a(),i(3,"td",15),o(4),a(),i(5,"td")(6,"button",16),u("click",function(){let s=_(e).$implicit,p=c();return f(p.onOpenUpsertWorkspaceModal(s))}),o(7," Edit "),a()()()}if(n&2){let e=t.$implicit,r=t.$index;l(2),k(r+1),l(2),h(" ",e==null?null:e.groupName," ")}}function Qe(n,t){n&1&&(i(0,"tr")(1,"td",17),o(2," No records found. "),a()())}function Xe(n,t){if(n&1){let e=y();i(0,"app-upsert-machine-group",18),u("close",function(){_(e);let s=c();return f(s.onCloseMachineGroupModal())})("upsert",function(s){_(e);let p=c();return f(p.upsertMachineGroupModalEvent(s))}),a()}if(n&2){let e=c();v("machineGroupData",e.upsertMachineGroupModalData)}}var xe=class n{_coreService=C(M);_apiFs=C(w);upsertMachineGroupModalData;isUpsertMachineGroupModalOpen=!1;ngOnInit(){this.loadList()}machineGroupList=[];loadList(){this._apiFs.machineGroup.list().subscribe({next:t=>{t.code==="OK"&&(this.machineGroupList=t.data||[])},error:t=>{}})}onOpenUpsertWorkspaceModal(t=null){this.upsertMachineGroupModalData=t,this.isUpsertMachineGroupModalOpen=!0}onCloseMachineGroupModal(){this.isUpsertMachineGroupModalOpen=!1}upsertMachineGroupModalEvent(t){let e=t?this.machineGroupList.findIndex(r=>r._id===t._id):-1;e>-1?this.machineGroupList[e]=t:this.loadList(),this.onCloseMachineGroupModal()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=E({type:n,selectors:[["app-machine-group"]],decls:27,vars:2,consts:[[1,"container-xxl","p-3","my-4","bg-white","shadow-sm","rounded-2","border"],[1,"table-responsive"],[1,"table","caption-top","table-striped","table-hover"],[1,"d-flex","align-items-center","justify-content-between","gap-2","flex-wrap"],[1,"text-capitialise","fs-5"],[1,"btn","btn-outline-primary","btn-sm","d-flex","align-items-center","gap-1",3,"click"],["height","18","width","18","viewBox","0 0 48 48",1,"flex-shrink-0"],["fill","none","stroke","currentColor","stroke-miterlimit","10","stroke-width","4","stroke-linecap","round","x1","8","x2","40","y1","24","y2","24"],["fill","none","stroke","currentColor","stroke-miterlimit","10","stroke-width","4","stroke-linecap","round","x1","24","x2","24","y1","8","y2","40"],[1,"text-nowrap"],[1,"table-dark","bg-opacity-50"],["scope","col",1,"w-1-percent"],["scope","col",1,"text-nowrap"],[3,"machineGroupData"],["scope","row"],[1,"text-capitalize"],[1,"btn","btn-outline-primary","btn-sm",3,"click"],["colspan","3",1,"text-muted","small","text-center"],[3,"close","upsert","machineGroupData"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"div",1)(2,"table",2)(3,"caption")(4,"div",3)(5,"strong",4),o(6," Machine Group "),a(),i(7,"div")(8,"button",5),u("click",function(){return r.onOpenUpsertWorkspaceModal()}),W(),i(9,"svg",6),x(10,"line",7)(11,"line",8),a(),Y(),i(12,"span",9),o(13," New Machine Group "),a()()()()(),i(14,"thead",10)(15,"tr")(16,"th",11),o(17,"#"),a(),i(18,"th",12),o(19," Group Name "),a(),i(20,"th",11),o(21," Action "),a()()(),i(22,"tbody"),b(23,Je,8,2,"tr",null,He,!1,Qe,3,0,"tr"),a()()()(),d(26,Xe,1,1,"app-upsert-machine-group",13)),e&2&&(l(23),S(r.machineGroupList),l(3),m(r.isUpsertMachineGroupModalOpen?26:-1))},dependencies:[Ce],encapsulation:2})};var $e=(n,t)=>t._id;function Ze(n,t){if(n&1){let e=y();i(0,"tr")(1,"th",8),o(2),a(),i(3,"td",9),o(4),a(),i(5,"td",9),o(6),a(),i(7,"td",9),o(8),a(),i(9,"td",9),o(10),a(),i(11,"td",9)(12,"div",10),u("click",function(){let s=_(e).$implicit,p=c();return f(p.onToggleAlert(s))}),i(13,"span",11)(14,"span",12),o(15),a()()()(),i(16,"td")(17,"button",13),u("click",function(){let s=_(e).$implicit,p=c();return f(p.onOpenUpsertMachineConfigureModal(s))}),o(18," Edit "),a()()()}if(n&2){let e=t.$implicit,r=t.$index;l(2),k(r+1),l(2),h(" ",e==null?null:e.machineCode," "),l(2),h(" ",e==null?null:e.machineName," "),l(2),h(" ",(e==null||e.machineGroupId==null?null:e.machineGroupId.groupName)||"-"," "),l(2),h(" ",e==null?null:e.ip," "),l(2),L("on",e.isAlertActive),l(3),h(" ",e.isAlertActive?"On":"Off"," ")}}function et(n,t){n&1&&(i(0,"tr")(1,"td",14),o(2," No records found. "),a()())}function tt(n,t){n&1&&(i(0,"span"),o(1,"Group Name is required."),a())}function nt(n,t){n&1&&(i(0,"span"),o(1," Machine Code must start with 'M' followed by numbers only. "),a())}function it(n,t){if(n&1&&(i(0,"div",29),d(1,tt,2,0,"span"),d(2,nt,2,0,"span"),a()),n&2){let e=c(2);l(),m(!(e.machineCode==null||e.machineCode.errors==null)&&e.machineCode.errors.required?1:-1),l(),m(!(e.machineCode==null||e.machineCode.errors==null)&&e.machineCode.errors.pattern?2:-1)}}function at(n,t){if(n&1&&(i(0,"option",33),o(1),a()),n&2){let e=t.$implicit;v("value",e==null?null:e._id),l(),h(" ",e==null?null:e.groupName," ")}}function rt(n,t){n&1&&(i(0,"span"),o(1,"Machine Max Speed is required."),a())}function ot(n,t){if(n&1&&(i(0,"span"),o(1),a()),n&2){let e=c(3);l(),h(" Enter at least ",e.maxSpeedLimit==null||e.maxSpeedLimit.errors==null||e.maxSpeedLimit.errors.min==null?null:e.maxSpeedLimit.errors.min.min," for machine speed. ")}}function lt(n,t){if(n&1&&(i(0,"div",29),d(1,rt,2,0,"span"),d(2,ot,2,1,"span"),a()),n&2){let e=c(2);l(),m(!(e.maxSpeedLimit==null||e.maxSpeedLimit.errors==null)&&e.maxSpeedLimit.errors.required?1:-1),l(),m(!(e.maxSpeedLimit==null||e.maxSpeedLimit.errors==null)&&e.maxSpeedLimit.errors.min?2:-1)}}function st(n,t){if(n&1){let e=y();i(0,"div",7)(1,"div",15)(2,"div",16)(3,"form",17),u("ngSubmit",function(){_(e);let s=c();return f(s.upsertMachineConfigure())}),i(4,"div",18)(5,"h1",19),o(6," Edit Machine Configuration "),a(),i(7,"button",20),u("click",function(){_(e);let s=c();return f(s.onCloseMachineConfigureModal())}),a()(),i(8,"div",21)(9,"div",22)(10,"div",23)(11,"label",24),o(12," Company Name "),i(13,"span",25),o(14,"*"),a()(),x(15,"input",26),a(),i(16,"div",23)(17,"label",27),o(18," Machine Code "),i(19,"span",25),o(20,"*"),a()(),x(21,"input",28),d(22,it,3,2,"div",29),a(),i(23,"div",23)(24,"label",30),o(25," Machine Group Name "),a(),i(26,"select",31)(27,"option",32),o(28,"Select Machine Group"),a(),b(29,at,2,2,"option",33,$e),a()(),i(31,"div",23)(32,"label",34),o(33," Machine Max Speed Limit "),a(),x(34,"input",35),d(35,lt,3,2,"div",29),a(),i(36,"div",36)(37,"span",37),o(38," Alert "),a(),i(39,"div",10),u("click",function(){_(e);let s=c();return f(s.onChangeAlert())}),i(40,"span",38)(41,"span",12),o(42),a()()()()()(),i(43,"div",39)(44,"button",40),u("click",function(){_(e);let s=c();return f(s.onCloseMachineConfigureModal())}),o(45," Cancel "),a(),i(46,"button",41),o(47," Update "),a()()()()()()}if(n&2){let e=c();l(3),v("formGroup",e.mcForm),l(19),m(e.machineCode!=null&&e.machineCode.touched&&(e.machineCode!=null&&e.machineCode.errors)?22:-1),l(7),S(e.machineGroupList),l(6),m(e.maxSpeedLimit!=null&&e.maxSpeedLimit.touched&&(e.maxSpeedLimit!=null&&e.maxSpeedLimit.errors)?35:-1),l(4),L("on",e.isAlertActive==null?null:e.isAlertActive.value),l(3),h(" ",e.isAlertActive!=null&&e.isAlertActive.value?"On":"Off"," ")}}var ve=class n{_coreService=C(M);_apiFs=C(w);_fb=C(A);upsertMachineConfigureModalData;isUpsertMachineConfigureModalOpen=!1;mcForm=this._fb.group({machineName:["",[]],machineCode:["",[g.required,g.pattern("^M[0-9]+$")]],machineGroupId:["",[]],maxSpeedLimit:[null,[g.min(0)]],isAlertActive:[!1,[]]});ngOnInit(){this.loadList(),this.loadMachineGroupList()}machineConfigureList=[];loadList(){this._apiFs.machineConfigure.list().subscribe({next:t=>{t.code==="OK"&&(this.machineConfigureList=t.data||[])},error:t=>{}})}machineGroupList=[];selectedMachineGroup;loadMachineGroupList(){this._apiFs.machineGroup.list().subscribe({next:t=>{t.code==="OK"&&(this.machineGroupList=t.data||[])},error:t=>{}})}get machineName(){return this.mcForm.get("machineName")}get machineCode(){return this.mcForm.get("machineCode")}get machineGroupId(){return this.mcForm.get("machineGroupId")}get maxSpeedLimit(){return this.mcForm.get("maxSpeedLimit")}get isAlertActive(){return this.mcForm.get("isAlertActive")}onChangeAlert(){this.isAlertActive?.patchValue(!this.isAlertActive.value)}onOpenUpsertMachineConfigureModal(t){t&&(this.upsertMachineConfigureModalData=t,this.mcForm.patchValue({machineName:t?.machineName??"",machineCode:t?.machineCode??"",machineGroupId:t?.machineGroupId?._id??"",maxSpeedLimit:t?.maxSpeedLimit??null,isAlertActive:t?.isAlertActive??!1}),this.machineName?.disable(),this.isUpsertMachineConfigureModalOpen=!0)}onCloseMachineConfigureModal(){this.isUpsertMachineConfigureModalOpen=!1,this.upsertMachineConfigureModalData=null,this.mcForm.reset({machineName:"",machineCode:"",machineGroupId:"",maxSpeedLimit:null,isAlertActive:!1})}isReqAlive=!1;upsertMachineConfigure(){if(this.isReqAlive||!this.upsertMachineConfigureModalData?._id)return;if(this.mcForm?.invalid){this.mcForm.markAllAsTouched();return}this.isReqAlive=!0;let t=R({},this.mcForm.value);t.machineGroupId=t.machineGroupId||null,this._apiFs.machineConfigure.update(this.upsertMachineConfigureModalData._id,t).subscribe({next:e=>{if(this.isReqAlive=!1,e.code==="OK"){let r=this.machineConfigureList.findIndex(s=>s._id===this.upsertMachineConfigureModalData._id);r>-1&&e.data?._id&&(this.machineConfigureList[r]=e.data),this._coreService.utils.showToaster("success","Machine configuration updated successfully."),this.onCloseMachineConfigureModal()}},error:e=>{this.isReqAlive=!1;let r=e?.error?.message||"Something went wrong, please try again later.";this._coreService.utils.showToaster("danger",r)}})}onToggleAlert(t){if(this.isReqAlive||!t?._id)return;this.isReqAlive=!0;let e={isAlertActive:!t.isAlertActive};this._apiFs.machineConfigure.update(t._id,e).subscribe({next:r=>{if(this.isReqAlive=!1,r.code==="OK"){let s=this.machineConfigureList.findIndex(p=>p._id===t._id);s>-1&&r.data?._id&&(this.machineConfigureList[s]=r.data),this._coreService.utils.showToaster("success","Alert updated successfully."),this.onCloseMachineConfigureModal()}},error:r=>{this.isReqAlive=!1;let s=r?.error?.message||"Something went wrong, please try again later.";this._coreService.utils.showToaster("danger",s)}})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=E({type:n,selectors:[["app-machine-configure"]],decls:26,vars:2,consts:[[1,"container-xxl","p-3","my-4","bg-white","shadow-sm","rounded-2","border"],[1,"table-responsive"],[1,"table","caption-top","table-striped","table-hover"],[1,"text-capitalize","fs-5","fw-bold","pt-0"],[1,"table-dark","bg-opacity-50"],["scope","col",1,"w-1-percent"],["scope","col",1,"text-nowrap"],[1,"modal","d-block"],["scope","row"],[1,"text-capitalize"],[1,"custom-switch",3,"click"],[1,"switch-track","shadow-sm"],[1,"switch-thumb"],[1,"btn","btn-outline-primary","btn-sm",3,"click"],["colspan","7",1,"text-muted","small","text-center"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content","shadow-lg"],[3,"ngSubmit","formGroup"],[1,"modal-header"],[1,"modal-title","fs-5"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"row"],[1,"col-12","mb-3"],["for","machineName",1,"form-label"],[1,"text-danger"],["type","text","id","machineName","formControlName","machineName",1,"form-control","text-capitalize"],["for","machineCode",1,"form-label"],["type","text","id","machineCode","formControlName","machineCode","placeholder","Enter Machine Code",1,"form-control"],[1,"invalid-feedback","d-block"],["for","machineGroupName",1,"form-label"],["id","machineGroupName","formControlName","machineGroupId",1,"form-select","w-100","text-capitalize"],["value","","selected",""],[3,"value"],["for","maxSpeedLimit",1,"form-label"],["type","number","id","maxSpeedLimit","formControlName","maxSpeedLimit","placeholder","Enter Machine Max Speed Limit",1,"form-control"],[1,"col-12","mb-3","d-flex","align-items-center"],[1,"form-label","me-3","mb-0"],[1,"switch-track"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary","me-3",3,"click"],[1,"btn","btn-primary"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"div",1)(2,"table",2)(3,"caption",3),o(4," Machine Configure "),a(),i(5,"thead",4)(6,"tr")(7,"th",5),o(8,"#"),a(),i(9,"th",6),o(10," Machine Code "),a(),i(11,"th",6),o(12," Company Name "),a(),i(13,"th",6),o(14," Machine Group "),a(),i(15,"th",6),o(16," IP "),a(),i(17,"th",6),o(18," Alert "),a(),i(19,"th",5),o(20," Action "),a()()(),i(21,"tbody"),b(22,Ze,19,8,"tr",null,$e,!1,et,3,0,"tr"),a()()()(),d(25,st,48,6,"div",7)),e&2&&(l(22),S(r.machineConfigureList),l(3),m(r.isUpsertMachineConfigureModalOpen?25:-1))},dependencies:[V,B,ae,re,P,Oe,ie,D,U,O,G],styles:[".custom-switch[_ngcontent-%COMP%]{display:inline-block;cursor:pointer;-webkit-user-select:none;user-select:none}.custom-switch[_ngcontent-%COMP%]   .switch-track[_ngcontent-%COMP%]{position:relative;display:inline-flex;align-items:center;width:3.2em;background-color:#eccdd1;border-radius:2em;transition:background-color .3s ease;padding:.2em}.custom-switch[_ngcontent-%COMP%]   .switch-track[_ngcontent-%COMP%]   .switch-thumb[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;min-width:2em;height:2em;color:#fff;background-color:#dc3545;border-radius:50%;transition:all .2s ease;font-size:.6em;font-weight:600}.custom-switch.on[_ngcontent-%COMP%]   .switch-track[_ngcontent-%COMP%]{background-color:#bee9bf}.custom-switch.on[_ngcontent-%COMP%]   .switch-track[_ngcontent-%COMP%]   .switch-thumb[_ngcontent-%COMP%]{background-color:#4caf50;transform:translate(2.65em)}"]})};var ct=(n,t)=>t._id;function dt(n,t){if(n&1){let e=y();N(0,"tr")(1,"th",8),o(2),T(),N(3,"td",9),o(4),T(),N(5,"td",9),o(6),T(),N(7,"td",9),o(8),T(),N(9,"td",9),o(10),T(),N(11,"td",10),o(12),T(),N(13,"td",9)(14,"div",11),Le("click",function(){let s=_(e).$implicit,p=c();return f(p.onToggleAlert(s))}),N(15,"span",12)(16,"span",13),o(17),T()()()()()}if(n&2){let e=t.$implicit,r=t.$index;l(2),k(r+1),l(2),h(" ",e==null?null:e.name," "),l(2),h(" ",e==null?null:e.categoryType," "),l(2),h(" ",e==null?null:e.scheduleDays," "),l(2),h(" ",e==null?null:e.alertDays," "),l(2),h(" ",e==null?null:e.alertMessage," "),l(2),L("on",e.isActive),l(3),h(" ",e.isActive?"Active":"Inactive"," ")}}function mt(n,t){n&1&&(N(0,"tr")(1,"td",14),o(2," No records found. "),T()())}var ye=class n{_coreService=C(M);_apiFs=C(w);ngOnInit(){this.loadList()}maintenanceCategoryList=[];loadList(){this._apiFs.maintenanceCategory.list().subscribe({next:t=>{t.code==="OK"&&(this.maintenanceCategoryList=t.data||[])},error:t=>{}})}isReqAlive=!1;onToggleAlert(t){if(this.isReqAlive||!t?._id)return;this.isReqAlive=!0;let e={isActive:!t.isActive};this._apiFs.maintenanceCategory.update(t._id,e).subscribe({next:r=>{if(this.isReqAlive=!1,r.code==="OK"){let s=this.maintenanceCategoryList.findIndex(p=>p._id===t._id);s>-1&&r.data?._id&&(this.maintenanceCategoryList[s]=r.data),this._coreService.utils.showToaster("success","Alert updated successfully.")}},error:r=>{this.isReqAlive=!1;let s=r?.error?.message||"Something went wrong, please try again later.";this._coreService.utils.showToaster("danger",s)}})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=E({type:n,selectors:[["app-maintenance-category"]],decls:25,vars:1,consts:[[1,"container-xxl","p-3","my-4","bg-white","shadow-sm","rounded-2","border"],[1,"table-responsive"],[1,"table","caption-top","table-striped","table-hover"],[1,"text-capitalize","fs-5","fw-bold","pt-0"],[1,"table-dark","bg-opacity-50"],["scope","col",1,"w-1-percent"],["scope","col"],["scope","col",1,"text-nowrap"],["scope","row"],[1,"text-capitalize"],[1,"text-capitalize","text-danger"],[1,"custom-switch",3,"click"],[1,"switch-track","shadow-sm"],[1,"switch-thumb"],["colspan","7",1,"text-muted","small","text-center"]],template:function(e,r){e&1&&(N(0,"div",0)(1,"div",1)(2,"table",2)(3,"caption",3),o(4," Maintenance Category "),T(),N(5,"thead",4)(6,"tr")(7,"th",5),o(8,"#"),T(),N(9,"th",6),o(10," Category "),T(),N(11,"th",6),o(12," Type "),T(),N(13,"th",7),o(14," Schedule Days "),T(),N(15,"th",7),o(16," Alert Days "),T(),N(17,"th",7),o(18," Alert Message "),T(),N(19,"th",6),o(20," Status "),T()()(),N(21,"tbody"),b(22,dt,18,9,"tr",null,ct,!1,mt,3,0,"tr"),T()()()()),e&2&&(l(22),S(r.maintenanceCategoryList))},styles:[".custom-switch[_ngcontent-%COMP%]{display:inline-block;cursor:pointer;-webkit-user-select:none;user-select:none}.custom-switch[_ngcontent-%COMP%]   .switch-track[_ngcontent-%COMP%]{position:relative;display:inline-flex;align-items:center;width:4.5em;background-color:#eccdd1;border-radius:2em;transition:background-color .3s ease;padding:.2em}.custom-switch[_ngcontent-%COMP%]   .switch-track[_ngcontent-%COMP%]   .switch-thumb[_ngcontent-%COMP%]{padding:0 2px;display:flex;align-items:center;justify-content:center;min-width:2em;height:2em;color:#fff;background-color:#dc3545;border-radius:1em;transition:all .2s ease;font-size:.6em;font-weight:600}.custom-switch.on[_ngcontent-%COMP%]   .switch-track[_ngcontent-%COMP%]{background-color:#bee9bf}.custom-switch.on[_ngcontent-%COMP%]   .switch-track[_ngcontent-%COMP%]   .switch-thumb[_ngcontent-%COMP%]{background-color:#4caf50;transform:translate(3.2em)}"]})};var De=ke(Fe());var pt=(n,t)=>t.machineId,ut=(n,t)=>t._id;function ht(n,t){if(n&1){let e=y();i(0,"div",12),u("click",function(){let s=_(e).$implicit,p=c().$implicit,F=c();return f(F.onOpenUpsertMaintenanceEntryModal(p,s))}),i(1,"span",13)(2,"span",14),o(3),a()(),i(4,"span",15),o(5),ee(6,"date"),a()()}if(n&2){let e=t.$implicit;l(3),h(" ",e==null?null:e.categoryName," "),l(),Pe(e!=null&&e.isDue?"text-danger":"text-primary"),l(),h(" ",te(6,4,e==null?null:e.nextMaintenanceDate,"dd-MM-yyyy")," ")}}function _t(n,t){if(n&1&&(i(0,"div",4)(1,"div",7)(2,"span",8),o(3),a(),i(4,"span",9),o(5),a()(),i(6,"div",10),b(7,ht,7,7,"div",11,ut),a()()),n&2){let e=t.$implicit;l(3),h(" ",e.machineCode," "),l(2),h(" ",e.machineName," "),l(2),S(e.alerts)}}function ft(n,t){n&1&&(i(0,"span",5),o(1," No records found. "),a())}function gt(n,t){n&1&&(i(0,"span"),o(1,"Complete date is required."),a())}function Ct(n,t){n&1&&(i(0,"span"),o(1," Complete date must be before the next maintenance date. "),a())}function xt(n,t){if(n&1&&(i(0,"div",32),d(1,gt,2,0,"span"),d(2,Ct,2,0,"span"),a()),n&2){let e=c(2);l(),m(!(e.lastMaintenanceDate==null||e.lastMaintenanceDate.errors==null)&&e.lastMaintenanceDate.errors.required?1:-1),l(),m(!(e.lastMaintenanceDate==null||e.lastMaintenanceDate.errors==null)&&e.lastMaintenanceDate.errors.lastDateInvalid?2:-1)}}function vt(n,t){n&1&&(i(0,"span"),o(1,"Next Maintenance date is required."),a())}function yt(n,t){n&1&&(i(0,"span"),o(1," Next maintenance date must be after the last maintenance date. "),a())}function bt(n,t){if(n&1&&(i(0,"div",32),d(1,vt,2,0,"span"),d(2,yt,2,0,"span"),a()),n&2){let e=c(2);l(),m(!(e.nextMaintenanceDate==null||e.nextMaintenanceDate.errors==null)&&e.nextMaintenanceDate.errors.required?1:-1),l(),m(!(e.nextMaintenanceDate==null||e.nextMaintenanceDate.errors==null)&&e.nextMaintenanceDate.errors.nextDateInvalid?2:-1)}}function St(n,t){n&1&&(i(0,"span"),o(1,"Name is required."),a())}function Et(n,t){n&1&&(i(0,"span"),o(1," Input cannot be empty or only spaces "),a())}function Mt(n,t){if(n&1&&(i(0,"div",32),d(1,St,2,0,"span"),d(2,Et,2,0,"span"),a()),n&2){let e=c(2);l(),m(!(e.completedBy==null||e.completedBy.errors==null)&&e.completedBy.errors.required?1:-1),l(),m(!(e.completedBy==null||e.completedBy.errors==null)&&e.completedBy.errors.pattern?2:-1)}}function wt(n,t){n&1&&(i(0,"span"),o(1,"Phone no is required."),a())}function Nt(n,t){n&1&&(i(0,"span"),o(1," Enter a valid mobile number (with or without +91) "),a())}function Tt(n,t){if(n&1&&(i(0,"div",32),d(1,wt,2,0,"span"),d(2,Nt,2,0,"span"),a()),n&2){let e=c(2);l(),m(!(e.phone==null||e.phone.errors==null)&&e.phone.errors.required?1:-1),l(),m(!(e.phone==null||e.phone.errors==null)&&e.phone.errors.pattern?2:-1)}}function kt(n,t){if(n&1&&(i(0,"span"),o(1),a()),n&2){let e=c(3);l(),h(" Remarks cannot exceed ",e.remarks==null||e.remarks.errors==null||e.remarks.errors.maxlength==null?null:e.remarks.errors.maxlength.requiredLength," characters. ")}}function Ft(n,t){if(n&1&&(i(0,"div",32),d(1,kt,2,1,"span"),a()),n&2){let e=c(2);l(),m(!(e.remarks==null||e.remarks.errors==null)&&e.remarks.errors.maxlength?1:-1)}}function Dt(n,t){if(n&1){let e=y();i(0,"div",6)(1,"div",16)(2,"div",17)(3,"form",18),u("ngSubmit",function(){_(e);let s=c();return f(s.onSubmitUpdateMaintenanceEntry())}),i(4,"div",19)(5,"h1",20),o(6," Edit Maintenance Entry "),a(),i(7,"button",21),u("click",function(){_(e);let s=c();return f(s.onCloseMaintenanceEntryModal())}),a()(),i(8,"div",22)(9,"div",23)(10,"span",24),o(11," Machine Name "),a(),i(12,"span",25),o(13),a()(),i(14,"div",26)(15,"span",24),o(16," Maintenance Category "),a(),i(17,"span",25),o(18),a()(),i(19,"div",27)(20,"div",28)(21,"label",29),o(22," Complete Date "),i(23,"span",30),o(24,"*"),a()(),x(25,"input",31),d(26,xt,3,2,"div",32),a(),i(27,"div",28)(28,"label",33),o(29," Next Maintenance Date "),i(30,"span",30),o(31,"*"),a()(),x(32,"input",34),d(33,bt,3,2,"div",32),a(),i(34,"div",28)(35,"span",35),o(36," Completed By "),i(37,"span",30),o(38,"*"),a()(),x(39,"input",36),d(40,Mt,3,2,"div",32),x(41,"input",37),d(42,Tt,3,2,"div",32),a(),i(43,"div",28)(44,"label",38),o(45," Remarks "),a(),x(46,"textarea",39),d(47,Ft,2,1,"div",32),a()()(),i(48,"div",40)(49,"button",41),u("click",function(){_(e);let s=c();return f(s.onCloseMaintenanceEntryModal())}),o(50," Cancel "),a(),i(51,"button",42),o(52," Update "),a()()()()()()}if(n&2){let e=c();l(3),v("formGroup",e.meForm),l(10),h(" ",e.upsertMaintenanceEntryModalData==null?null:e.upsertMaintenanceEntryModalData.machineName," "),l(5),h(" ",e.upsertMaintenanceEntryModalData==null||e.upsertMaintenanceEntryModalData.alerts==null?null:e.upsertMaintenanceEntryModalData.alerts.categoryName," "),l(8),m(e.lastMaintenanceDate!=null&&e.lastMaintenanceDate.touched&&(e.lastMaintenanceDate!=null&&e.lastMaintenanceDate.errors)?26:-1),l(7),m(e.nextMaintenanceDate!=null&&e.nextMaintenanceDate.touched&&(e.nextMaintenanceDate!=null&&e.nextMaintenanceDate.errors)?33:-1),l(7),m(e.completedBy!=null&&e.completedBy.touched&&(e.completedBy!=null&&e.completedBy.errors)?40:-1),l(2),m(e.phone!=null&&e.phone.touched&&(e.phone!=null&&e.phone.errors)?42:-1),l(5),m(e.remarks!=null&&e.remarks.touched&&(e.remarks!=null&&e.remarks.errors)?47:-1)}}var be=class n{_coreService=C(M);_apiFs=C(w);_fb=C(A);meForm=this._fb.group({lastMaintenanceDate:["",[g.required,this.lastMaintenanceDateValidator.bind(this)]],nextMaintenanceDate:["",[g.required,this.nextMaintenanceDateValidator.bind(this)]],completedBy:["",[g.required,g.pattern("^(?!s*$).+")]],phone:["",[g.required,g.pattern("^(?:\\+91[-\\s]?|91[-\\s]?|0)?[6-9]\\d{9}$")]],remarks:["",[g.maxLength(500)]]});ngOnInit(){this.loadList()}maintenanceEntryList=[];loadList(){this._apiFs.maintenanceEntry.list().subscribe({next:t=>{t.code==="OK"&&(this.maintenanceEntryList=t.data||[])},error:t=>{}})}get lastMaintenanceDate(){return this.meForm?.get("lastMaintenanceDate")}get nextMaintenanceDate(){return this.meForm?.get("nextMaintenanceDate")}get completedBy(){return this.meForm.get("completedBy")}get phone(){return this.meForm.get("phone")}get remarks(){return this.meForm.get("remarks")}lastMaintenanceDateValidator(t){return this.nextMaintenanceDate&&!this.nextMaintenanceDate?.touched&&this.nextMaintenanceDate.markAsTouched(),this.nextMaintenanceDate?.updateValueAndValidity(),null}nextMaintenanceDateValidator(t){if(!this.lastMaintenanceDate)return null;let e=this.lastMaintenanceDate?.value,r=t.value;if(!e||!r)return null;let s=new Date(e);return new Date(r)<=s?{nextDateInvalid:!0}:null}upsertMaintenanceEntryModalData;isUpsertMaintenanceEntryModalOpen=!1;onOpenUpsertMaintenanceEntryModal(t,e){!t?.machineId||!e?._id||(this.upsertMaintenanceEntryModalData=R({},t),this.upsertMaintenanceEntryModalData.alerts=R({},e),this.meForm.patchValue({lastMaintenanceDate:(0,De.default)().format("YYYY-MM-DD"),nextMaintenanceDate:(0,De.default)().add(this.upsertMaintenanceEntryModalData?.alerts?.scheduleDays??1,"days").format("YYYY-MM-DD"),completedBy:"",phone:"",remarks:""}),this.isUpsertMaintenanceEntryModalOpen=!0)}isReqAlive=!1;onSubmitUpdateMaintenanceEntry(){if(this.isReqAlive||!this.upsertMaintenanceEntryModalData?.machineId)return;if(this.meForm.invalid){this.meForm.markAllAsTouched();return}this.isReqAlive=!0;let t=R({},this.meForm.value);t.completedBy=t.completedBy.trim(),t.phone=t.phone.trim(),t.remarks=t.remarks.trim(),this._apiFs.maintenanceEntry.update(this.upsertMaintenanceEntryModalData?.alerts?._id,t).subscribe({next:e=>{this.isReqAlive=!1,e.code==="OK"&&(this.loadList(),this.onCloseMaintenanceEntryModal(),this._coreService.utils.showToaster("success","Maintenance entry updated successfully."))},error:e=>{this.isReqAlive=!1;let r=e?.error?.message||"Something went wrong, please try again later.";this._coreService.utils.showToaster("danger",r)}})}onCloseMaintenanceEntryModal(){this.isUpsertMaintenanceEntryModalOpen=!1,this.upsertMaintenanceEntryModalData=null,this.meForm.reset({lastMaintenanceDate:"",nextMaintenanceDate:"",completedBy:"",phone:"",remarks:""})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=E({type:n,selectors:[["app-maintenance-entry"]],decls:9,vars:2,consts:[[1,"container-xxl","p-3","my-4","bg-white","shadow-sm","rounded-2","border"],[1,"text-capitalize","text-muted","fs-5","fw-bold","pt-0","border-bottom"],[1,"table-responsive"],[1,"grid-layout","gap-3"],[1,"rounded","border","border-2","border-success","border-opacity-75","user-select-none"],[1,"text-muted","small","text-center"],[1,"modal","d-block"],[1,"d-flex","align-items-center","gap-3","text-white","bg-success","rounded-top-1","p-2"],[1,"text-uppercase","fw-bold","lh-1","me-auto"],[1,"text-capitalize","fw-bold","lh-1"],[1,"p-1","w-100","d-flex","flex-column","gap-1"],[1,"d-flex","align-items-center","border","border-secondary","rounded-2","py-1","px-2","c-pointer"],[1,"d-flex","align-items-center","border","border-secondary","rounded-2","py-1","px-2","c-pointer",3,"click"],[1,"me-auto"],[1,"small","category-name"],[1,"fw-semibold"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content","shadow-lg"],[3,"ngSubmit","formGroup"],[1,"modal-header"],[1,"modal-title","fs-5"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"d-flex","align-items-center","justify-content-center"],[1,"text-secondary","me-auto"],[1,"fw-semibold","text-primary","text-capitalize"],[1,"d-flex","align-items-center","justify-content-center","mb-3"],[1,"row"],[1,"col-12","mb-3"],["for","lastMaintenanceDate",1,"form-label"],[1,"text-danger"],["type","date","id","lastMaintenanceDate","formControlName","lastMaintenanceDate",1,"form-control"],[1,"invalid-feedback","d-block"],["for","nextMaintenanceDate",1,"form-label"],["type","date","id","nextMaintenanceDate","formControlName","nextMaintenanceDate",1,"form-control"],[1,"form-label","d-block"],["type","text","formControlName","completedBy","placeholder","Enter name",1,"form-control"],["type","text","formControlName","phone","placeholder","Enter phone",1,"form-control","mt-2"],["for","remarks",1,"form-label"],["name","remarks","id","remarks","formControlName","remarks","placeholder","Enter remark",1,"form-control",2,"max-height","6lh"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary","me-3",3,"click"],[1,"btn","btn-primary"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"h3",1),o(2," Maintenance Entry "),a(),i(3,"div",2)(4,"div",3),b(5,_t,9,2,"div",4,pt,!1,ft,2,0,"span",5),a()()(),d(8,Dt,53,8,"div",6)),e&2&&(l(5),S(r.maintenanceEntryList),l(3),m(r.isUpsertMaintenanceEntryModalOpen?8:-1))},dependencies:[V,B,P,D,U,O,G,ne],styles:[".grid-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr))}.category-name[_ngcontent-%COMP%]{display:-webkit-box;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;line-clamp:1;-webkit-line-clamp:1;word-break:break-all}"]})};var se=ke(Fe());var At=()=>["machineName","machineCode"],It=(n,t)=>t.date,Lt=(n,t)=>t.shift;function Pt(n,t){n&1&&(i(0,"span"),o(1,"Report date is required."),a())}function Ut(n,t){if(n&1&&(i(0,"div",8),d(1,Pt,2,0,"span"),a()),n&2){let e=c();l(),m(!(e.date==null||e.date.errors==null)&&e.date.errors.required?1:-1)}}function Ot(n,t){if(n&1&&(i(0,"option",11),o(1),a()),n&2){let e=t.$implicit;v("value",e),l(),h("",e||"All"," Shift")}}function Gt(n,t){n&1&&x(0,"span",16)}function Vt(n,t){if(n&1){let e=y();i(0,"div",29)(1,"span",30),o(2),a(),i(3,"textarea",31),he("ngModelChange",function(s){let p=_(e).$implicit;return ue(p.comment,s)||(p.comment=s),f(s)}),a()()}if(n&2){let e=t.$implicit,r=t.$index,s=c(),p=s.$implicit,F=s.$index;L("col-md-6",(p.shifts==null?null:p.shifts.length)>1),l(2),h(" ",e.shift," Shift: "),l(),pe("ngModel",e.comment),Ie("name",`${e.shift}-comment-${F}-${r}`)}}function Rt(n,t){if(n&1&&(i(0,"tr")(1,"td",24),o(2),a(),i(3,"td",25),o(4),i(5,"span",26),o(6),a()(),i(7,"td",25),o(8),ee(9,"date"),a(),i(10,"td")(11,"div",27),b(12,Vt,4,5,"div",28,Lt),a()()()),n&2){let e=t.$implicit,r=t.$index;l(2),k(r+1),l(2),h(" ",e==null||e.machineId==null?null:e.machineId.machineCode," "),l(2),h("(",e==null||e.machineId==null?null:e.machineId.machineName,")"),l(2),h(" ",te(9,4,e==null?null:e.date,"dd/MM/yyyy")," "),l(4),S(e.shifts)}}function qt(n,t){n&1&&(i(0,"tr")(1,"td",32),o(2,"No records found."),a()())}function Bt(n,t){if(n&1){let e=y();i(0,"div",14)(1,"button",15),u("click",function(){_(e);let s=c();return f(s.onSaveComments())}),d(2,Gt,1,0,"span",16),o(3," Save Comments "),a()(),i(4,"div",17)(5,"table",18)(6,"thead",19)(7,"tr")(8,"th",20),o(9,"#"),a(),i(10,"th",21),o(11,"Machine"),a(),i(12,"th",22),o(13,"Shift Date"),a(),i(14,"th",23),o(15,"Comments"),a()()(),i(16,"tbody"),b(17,Rt,14,7,"tr",null,It,!1,qt,3,0,"tr"),a()()()}if(n&2){let e=c();l(),L("disabled",e.isSaving),v("disabled",e.isSaving),l(),m(e.isSaving?2:-1),l(15),S(e.shiftWiseCommentList)}}var Se=class n{_coreService=C(M);_apiFs=C(w);_fb=C(A);filterForm=this._fb.group({machineId:[null,[]],date:[(0,se.default)().format("YYYY-MM-DD"),[g.required]],shift:["",[]]});defaultMachineOption={_id:"",machineCode:"Select All"};shiftOptions=["","day","night"];machineList=[];ngOnInit(){this.loadMachineList()}loadMachineList(){this._apiFs.machineConfigure.optionList().subscribe({next:t=>{t.code==="OK"&&(this.machineList=t.data||[],this.machineList.unshift(this.defaultMachineOption),this.machineId?.patchValue(this.defaultMachineOption))}})}get machineId(){return this.filterForm.get("machineId")}get date(){return this.filterForm.get("date")}get shift(){return this.filterForm.get("shift")}onSelectMachine(t){t&&this.machineId?.patchValue(t)}shiftWiseCommentList=[];shiftWiseCommentMap=new Map;isReportLoaded=!1;isReqLive=!1;isListUpdating=!1;onFilterSubmit(){if(this.isReqLive)return;let{date:t,shift:e,machineId:r}=this.filterForm.value,s={date:(0,se.default)(t).format("YYYY-MM-DD"),shift:e||null,machineId:r?._id||null},p=!s.shift&&!s.machineId;this.isReqLive=!0,this.isListUpdating||(this.isReportLoaded=!1),this._apiFs.shiftWiseComments.list(s).subscribe({next:F=>{if(this.isReqLive=!1,F.code==="OK"){let I=F.data?.list||[];this.shiftWiseCommentMap.clear(),I.forEach(Q=>{let Ye=this.getKey(Q.machineId,Q.shift,Q.date);this.shiftWiseCommentMap.set(Ye,Q)});let $=s.machineId?[r]:this.machineList.filter(Q=>Q._id),q=s.shift?[s.shift]:this.shiftOptions.filter(Q=>Q),de=(0,se.default)(s.date,"YYYY-MM-DD").startOf(p?"day":"month"),Te=(0,se.default)(s.date,"YYYY-MM-DD").endOf(p?"day":"month");this.generateCommentList($,q,de,Te),this.isListUpdating||(this.isReportLoaded=!0)}},error:()=>{this.isReqLive=!1,this.isReportLoaded=!1}})}getKey(t,e,r){return`${t}_${e}_${(0,se.default)(r).format("YYYY-MM-DD")}`}generateCommentList(t,e,r,s){let p=[],F=s.clone();if(this.isListUpdating){this.isListUpdating=!1;for(let I of this.shiftWiseCommentList){let $=I.machineId?._id||I.machineId,q=I.date;for(let de of I.shifts){let Te=this.getKey($,de.shift,q);de.comment=this.shiftWiseCommentMap.get(Te)?.comment||""}}return this.shiftWiseCommentList}for(;F.isSameOrAfter(r);){let I=F.format("YYYY-MM-DD");for(let $ of t)p.push({machineId:$,date:I,shifts:e.map(q=>({shift:q,comment:this.shiftWiseCommentMap.get(this.getKey($._id||$,q,I))?.comment||""}))});F.subtract(1,"day")}return this.shiftWiseCommentList=[...p],p}isSaving=!1;onSaveComments(){if(this.isSaving)return;let t=[];for(let e of this.shiftWiseCommentList){let r=e.machineId?._id||e.machineId,s=e.date;for(let p of e.shifts){let F=p.shift,I=p.comment?.trim()||"",$=this.getKey(r,F,s),q=this.shiftWiseCommentMap.get($);(q&&q.comment!==I||!q&&I)&&t.push({machineId:r,date:s,shift:F,comment:I})}}if(t.length===0){this._coreService.utils.showToaster("info","No changes to save.");return}this.isSaving=!0,this._apiFs.shiftWiseComments.update({list:t}).subscribe({next:e=>{this.isSaving=!1,e.code==="OK"&&(this.isListUpdating=!0,this.onFilterSubmit())},error:()=>{this.isSaving=!1}})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=E({type:n,selectors:[["app-shift-wise-comment"]],decls:23,vars:10,consts:[[1,"container-fluid","p-3","my-4","bg-white","shadow-sm","rounded-2","border"],[1,"d-inline-block","text-capitialise","text-muted","fs-5","mb-2"],[1,"row","mb-3","border-bottom",3,"formGroup"],[1,"col-md-4","mb-3"],[1,"d-inline-block","form-label","fw-semibold"],["displayKey1","machineCode","placeholder","Select All","listWrapClass","dpd-translate-y","uniqueKey","_id",3,"onSelect","selectedOption","optionsList","filterKeys"],["for","date",1,"form-label","fw-semibold"],["type","date","id","date","formControlName","date",1,"form-control"],[1,"invalid-feedback","d-block"],["for","shift",1,"form-label","fw-semibold"],["id","shift","formControlName","shift",1,"form-select","text-capitalize"],[3,"value"],[1,"text-center","mb-3","user-select-none"],["type","button",1,"btn","btn-outline-primary",3,"click","disabled"],[1,"text-end","mb-1"],["type","button",1,"btn","btn-primary","btn-sm",3,"click","disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],[1,"table-responsive"],[1,"table","table-bordered","table-striped","caption-top","align-middle","mb-0"],[1,"table-dark"],[1,"text-center",2,"width","3%"],[1,"text-center",2,"width","15%"],[1,"text-center","text-nowrap",2,"width","15%"],[1,"text-center",2,"width","50%"],[1,"text-center"],[1,"text-center","text-capitalize"],[1,"small","text-muted"],[1,"row","g-2"],[1,"col-12",3,"col-md-6"],[1,"col-12"],[1,"d-inline-block","small","text-capitalize","text-muted"],["placeholder","Enter comment here...",1,"form-control",2,"max-height","4lh",3,"ngModelChange","ngModel"],["colspan","5",1,"text-center"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"strong",1),o(2," Shift Wise Comments Report "),a(),i(3,"div",2)(4,"div",3)(5,"span",4),o(6,"Machine:"),a(),i(7,"app-common-dropdown",5),u("onSelect",function(p){return r.onSelectMachine(p)}),a()(),i(8,"div",3)(9,"label",6),o(10,"Report Date:"),a(),x(11,"input",7),d(12,Ut,2,1,"div",8),a(),i(13,"div",3)(14,"label",9),o(15,"Shift:"),a(),i(16,"select",10),b(17,Ot,2,2,"option",11,me),a()()(),i(19,"div",12)(20,"button",13),u("click",function(){return r.onFilterSubmit()}),o(21," Show Report "),a()(),d(22,Bt,20,5),a()),e&2&&(l(3),v("formGroup",r.filterForm),l(4),v("selectedOption",r.machineId==null?null:r.machineId.value)("optionsList",r.machineList)("filterKeys",Ue(9,At)),l(5),m(r.date!=null&&r.date.touched&&(r.date!=null&&r.date.errors)?12:-1),l(5),S(r.shiftOptions),l(3),L("disabled",r.filterForm.invalid),v("disabled",r.filterForm.invalid),l(2),m(r.isReportLoaded?22:-1))},dependencies:[V,ae,re,P,ie,D,U,O,G,oe,fe,ge,ne],encapsulation:2})};var We=ke(Fe());var $t=(n,t)=>t._id;function Wt(n,t){n&1&&(i(0,"span"),o(1,"Part name is required."),a())}function Yt(n,t){if(n&1&&(i(0,"div",13),d(1,Wt,2,0,"span"),a()),n&2){let e=c();l(),m(!(e.partName==null||e.partName.errors==null)&&e.partName.errors.required?1:-1)}}function zt(n,t){if(n&1&&(i(0,"option",17),o(1),a()),n&2){let e=t.$implicit;v("value",e._id),l(),ce(" ",e==null?null:e.machineName," (",e==null?null:e.machineCode,") ")}}function Kt(n,t){n&1&&(i(0,"span"),o(1,"Machine name is required."),a())}function jt(n,t){if(n&1&&(i(0,"div",13),d(1,Kt,2,0,"span"),a()),n&2){let e=c();l(),m(!(e.machineId==null||e.machineId.errors==null)&&e.machineId.errors.required?1:-1)}}function Ht(n,t){n&1&&(i(0,"span"),o(1,"Change date is required."),a())}function Jt(n,t){if(n&1&&(i(0,"div",13),d(1,Ht,2,0,"span"),a()),n&2){let e=c();l(),m(!(e.changeDate==null||e.changeDate.errors==null)&&e.changeDate.errors.required?1:-1)}}function Qt(n,t){n&1&&(i(0,"span"),o(1,"Name is required."),a())}function Xt(n,t){n&1&&(i(0,"span"),o(1," Input cannot be empty or only spaces "),a())}function Zt(n,t){if(n&1&&(i(0,"div",13),d(1,Qt,2,0,"span"),d(2,Xt,2,0,"span"),a()),n&2){let e=c();l(),m(!(e.changedBy==null||e.changedBy.errors==null)&&e.changedBy.errors.required?1:-1),l(),m(!(e.changedBy==null||e.changedBy.errors==null)&&e.changedBy.errors.pattern?2:-1)}}function en(n,t){n&1&&(i(0,"span"),o(1,"Phone no is required."),a())}function tn(n,t){n&1&&(i(0,"span"),o(1," Enter a valid mobile number (with or without +91) "),a())}function nn(n,t){if(n&1&&(i(0,"div",13),d(1,en,2,0,"span"),d(2,tn,2,0,"span"),a()),n&2){let e=c();l(),m(!(e.changedByContact==null||e.changedByContact.errors==null)&&e.changedByContact.errors.required?1:-1),l(),m(!(e.changedByContact==null||e.changedByContact.errors==null)&&e.changedByContact.errors.pattern?2:-1)}}function an(n,t){if(n&1&&(i(0,"span"),o(1),a()),n&2){let e=c(2);l(),h(" Notes cannot exceed ",e.notes==null||e.notes.errors==null||e.notes.errors.maxlength==null?null:e.notes.errors.maxlength.requiredLength," characters. ")}}function rn(n,t){if(n&1&&(i(0,"div",13),d(1,an,2,1,"span"),a()),n&2){let e=c();l(),m(!(e.notes==null||e.notes.errors==null)&&e.notes.errors.maxlength?1:-1)}}var Ee=class n{_coreService=C(M);_apiFs=C(w);_fb=C(A);isEditMode=!1;_partNameList=[];partNameList=[];machineList=[];pceData;closeOrCancel=new z;upsert=new z;pceForm=this._fb.group({partName:["",[g.required,g.maxLength(180)]],machineId:["",[g.required,g.maxLength(24)]],changeDate:["",[g.required]],changedBy:["",[g.required,g.pattern("^(?!s*$).+")]],changedByContact:["",[g.pattern("^(?:\\+91[-\\s]?|91[-\\s]?|0)?[6-9]\\d{9}$")]],notes:["",[g.maxLength(500)]]});ngOnChanges(t){t.partNameList?.currentValue&&(this._partNameList=[...t.partNameList?.currentValue||[]]),t.pceData?.currentValue&&(this.isEditMode=!!t.pceData?.currentValue?._id,this.pceForm.patchValue({partName:this.pceData?.partName??"",machineId:this.pceData?.machineId?._id??"",changeDate:this.pceData?.changeDate?(0,We.default)(this.pceData.changeDate).format("YYYY-MM-DD"):"",changedBy:this.pceData?.changedBy??"",changedByContact:this.pceData?.changedByContact??"",notes:this.pceData?.notes??""}))}get partName(){return this.pceForm.get("partName")}get machineId(){return this.pceForm.get("machineId")}get changeDate(){return this.pceForm.get("changeDate")}get changedBy(){return this.pceForm.get("changedBy")}get changedByContact(){return this.pceForm.get("changedByContact")}get notes(){return this.pceForm.get("notes")}onCreateNewPart(t){let e=(t??"").trim();this.partNameList.push(e),this._partNameList=[...this.partNameList],this.partName?.patchValue(e)}onSelectPart(t){this.partName?.patchValue(t)}isReqAlive=!1;onSubmit(){if(this.isReqAlive)return;if(this.pceForm.invalid){this.pceForm.markAllAsTouched();return}let t={machineId:this.machineId?.value?.trim(),partName:this.partName?.value?.trim(),changeDate:this.changeDate?.value,changedBy:this.changedBy?.value?.trim(),changedByContact:this.changedByContact?.value?.trim(),notes:this.notes?.value?.trim()};this.isReqAlive=!0,this.isEditMode?this._apiFs.partsChangeEntry.update(this.pceData._id,t).subscribe({next:e=>{this.isReqAlive=!1,e.code==="OK"&&(this._coreService.utils.showToaster("success","Parts Change Entry updated successfully."),this.upsert.emit(e.data),this.onCloseOrCancel())},error:e=>{this.isReqAlive=!1;let r=e?.error?.message||"Failed to update Parts Change Entry. Please try again.";this._coreService.utils.showToaster("danger",r)}}):this._apiFs.partsChangeEntry.create(t).subscribe({next:e=>{this.isReqAlive=!1,e.code==="OK"&&(this._coreService.utils.showToaster("success","Parts Change Entry created successfully."),this.upsert.emit(e.data),this.onCloseOrCancel())},error:e=>{this.isReqAlive=!1;let r=e?.error?.message||"Failed to create Parts Change Entry. Please try again.";this._coreService.utils.showToaster("danger",r)}})}onCloseOrCancel(){this.closeOrCancel.emit()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=E({type:n,selectors:[["app-upsert-parts-change-entry"]],inputs:{partNameList:"partNameList",machineList:"machineList",pceData:"pceData"},outputs:{closeOrCancel:"close",upsert:"upsert"},features:[Z],decls:57,vars:12,consts:[[1,"modal","d-block"],[1,"modal-dialog","modal-lg","modal-dialog-centered"],[1,"modal-content","shadow-lg"],[3,"ngSubmit","formGroup"],[1,"modal-header"],[1,"modal-title","fs-5"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"row"],[1,"col-12","col-md-6","mb-3"],["for","partName",1,"form-label"],[1,"text-danger"],["placeholder","Select Part name","listWrapClass","dpd-translate-y","uniqueKey","",3,"onSelect","onCreate","selectedOption","optionsList","enableCreate"],[1,"invalid-feedback","d-block"],["for","machineId",1,"form-label"],["name","machineId","id","machineId","formControlName","machineId",1,"form-select","text-capitalize"],["value",""],[3,"value"],["for","changeDate",1,"form-label"],["type","date","id","changeDate","formControlName","changeDate","placeholder","Enter Part Name",1,"form-control"],[1,"form-label","d-block"],["type","text","formControlName","changedBy","placeholder","Enter name",1,"form-control"],["type","text","formControlName","changedByContact","placeholder","Enter phone",1,"form-control","mt-2"],["for","notes",1,"form-label"],["name","notes","id","notes","formControlName","notes","placeholder","Enter notes",1,"form-control",2,"max-height","6lh"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary","me-3",3,"click"],[1,"btn","btn-primary"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3),u("ngSubmit",function(){return r.onSubmit()}),i(4,"div",4)(5,"h1",5),o(6),a(),i(7,"button",6),u("click",function(){return r.onCloseOrCancel()}),a()(),i(8,"div",7)(9,"div",8)(10,"div",9)(11,"label",10),o(12," Part Name "),i(13,"span",11),o(14,"*"),a()(),i(15,"app-common-dropdown",12),u("onSelect",function(p){return r.onSelectPart(p)})("onCreate",function(p){return r.onCreateNewPart(p)}),a(),d(16,Yt,2,1,"div",13),a(),i(17,"div",9)(18,"label",14),o(19," Machine Name "),i(20,"span",11),o(21,"*"),a()(),i(22,"select",15)(23,"option",16),o(24,"Select machine name"),a(),b(25,zt,2,3,"option",17,$t),a(),d(27,jt,2,1,"div",13),a(),i(28,"div",9)(29,"label",18),o(30," Change Date "),i(31,"span",11),o(32,"*"),a()(),x(33,"input",19),d(34,Jt,2,1,"div",13),a(),i(35,"div",9)(36,"span",20),o(37," Changed By(Name)"),i(38,"span",11),o(39,"*"),a()(),x(40,"input",21),d(41,Zt,3,2,"div",13),a(),i(42,"div",9)(43,"span",20),o(44," Changed By(Phone) "),a(),x(45,"input",22),d(46,nn,3,2,"div",13),a(),i(47,"div",9)(48,"label",23),o(49," Notes "),a(),x(50,"textarea",24),d(51,rn,2,1,"div",13),a()()(),i(52,"div",25)(53,"button",26),u("click",function(){return r.onCloseOrCancel()}),o(54," Cancel "),a(),i(55,"button",27),o(56),a()()()()()()),e&2&&(l(3),v("formGroup",r.pceForm),l(3),h(" ",r.isEditMode?"Edit":"Create"," Part Change Log "),l(9),v("selectedOption",r.partName==null?null:r.partName.value)("optionsList",r._partNameList)("enableCreate",!0),l(),m(r.partName!=null&&r.partName.touched&&(r.partName!=null&&r.partName.errors)?16:-1),l(9),S(r.machineList),l(2),m(r.machineId!=null&&r.machineId.touched&&(r.machineId!=null&&r.machineId.errors)?27:-1),l(7),m(r.changeDate!=null&&r.changeDate.touched&&(r.changeDate!=null&&r.changeDate.errors)?34:-1),l(7),m(r.changedBy!=null&&r.changedBy.touched&&(r.changedBy!=null&&r.changedBy.errors)?41:-1),l(5),m(r.changedByContact!=null&&r.changedByContact.touched&&(r.changedByContact!=null&&r.changedByContact.errors)?46:-1),l(5),m(r.notes!=null&&r.notes.touched&&(r.notes!=null&&r.notes.errors)?51:-1),l(5),h(" ",r.isEditMode?"Update":"Create"," "))},dependencies:[V,B,ae,re,P,ie,D,U,O,G,ge],encapsulation:2})};var on=(n,t)=>t._id;function ln(n,t){if(n&1&&(i(0,"span",25),o(1),a()),n&2){let e=c().$implicit;l(),h(" (",e==null?null:e.changedByContact,") ")}}function sn(n,t){if(n&1){let e=y();i(0,"tr")(1,"th",22),o(2),a(),i(3,"td",23),o(4),a(),i(5,"td",23),o(6),a(),i(7,"td",23),o(8),ee(9,"date"),a(),i(10,"td",23)(11,"span",24),o(12),a(),d(13,ln,2,1,"span",25),a(),i(14,"td")(15,"button",26),u("click",function(){let s=_(e).$implicit,p=c();return f(p.onOpenUpsertPartChangeModal(s))}),o(16," Edit "),a()()()}if(n&2){let e=t.$implicit,r=t.$index;l(2),k(r+1),l(2),h(" ",e==null?null:e.partName," "),l(2),ce(" ",e==null||e.machineId==null?null:e.machineId.machineName," (",e==null||e.machineId==null?null:e.machineId.machineCode,") "),l(2),h(" ",te(9,7,e==null?null:e.changeDate,"dd-MM-yyyy")," "),l(4),h(" ",e==null?null:e.changedBy," "),l(),m(e!=null&&e.changedByContact?13:-1)}}function cn(n,t){n&1&&(i(0,"tr")(1,"td",27),o(2," No records found. "),a()())}function dn(n,t){if(n&1){let e=y();i(0,"app-upsert-parts-change-entry",28),u("close",function(){_(e);let s=c();return f(s.onClosePartChangeModal())})("upsert",function(s){_(e);let p=c();return f(p.upsertPartChangeModalEvent(s))}),a()}if(n&2){let e=c();v("machineList",e.machineList)("partNameList",e.partsNameList)("pceData",e.upsertPartsChangeEntryModalData)}}function mn(n,t){if(n&1){let e=y();i(0,"div",41)(1,"input",46),he("ngModelChange",function(s){let p=_(e).$implicit;return ue(p.selected,s)||(p.selected=s),f(s)}),u("ngModelChange",function(){_(e);let s=c(2);return f(s.onFilterSelectionChange())}),a(),i(2,"label",47)(3,"span",39),o(4),a()()()}if(n&2){let e=t.$implicit,r=t.$index;l(),v("id",e._id+r)("checked",e.selected),pe("ngModel",e.selected),l(),v("for",e._id+r),l(2),ce(" ",e==null?null:e.machineCode," - ",e==null?null:e.machineName," ")}}function pn(n,t){if(n&1&&(i(0,"div",42),o(1),a()),n&2){let e=c(2);l(),h(" ",e.cacheSearchTerm?"No matches found for the search term.":"No machines available to filter."," ")}}function un(n,t){if(n&1){let e=y();i(0,"div",21)(1,"div",29)(2,"div",30)(3,"div",31)(4,"h1",32),o(5," Filter Machine Parts Changes "),a(),i(6,"button",33),u("click",function(){_(e);let s=c();return f(s.onCloseOrCancelFilterPopup())}),a()(),i(7,"div",34)(8,"app-search-input",35),u("onSearch",function(s){_(e);let p=c();return f(p.onSearchTerms(s))}),a(),i(9,"div",36)(10,"input",37),u("click",function(){_(e);let s=c();return f(s.onToggleSelectAllFilters())}),a(),i(11,"label",38)(12,"span",39),o(13," Select / Deselect All "),a()()(),i(14,"div",40),b(15,mn,5,6,"div",41,me,!1,pn,2,1,"div",42),a()(),i(18,"div",43)(19,"button",44),u("click",function(){_(e);let s=c();return f(s.onCloseOrCancelFilterPopup())}),o(20," Cancel "),a(),i(21,"button",45),u("click",function(){_(e);let s=c();return f(s.onApplyFilterPopup())}),o(22," Apply Filters "),a()()()()()}if(n&2){let e=c();l(8),v("searchTerms",e.cacheSearchTerm),l(2),v("checked",e.isAllFilterSelected),l(5),S(e.filteredFilterPartChangeList)}}var Me=class n{_coreService=C(M);_apiFs=C(w);_fb=C(A);partsNameList=[];partChangeList=[];filteredPartChangeList=[];machineList=[];upsertPartsChangeEntryModalData;isUpsertPartsChangeEntryModalOpen=!1;toggleFilterPopup=!1;cacheSearchTerm="";ngOnInit(){this.loadPartsNameList(),this.loadMachineList(),this.loadList()}loadPartsNameList(){this._apiFs.partsChangeEntry.partsList().subscribe({next:t=>{t.code==="OK"&&(this.partsNameList=t.data||[])},error:t=>{console.error("Error fetching parts name list:",t)}})}loadMachineList(){this._apiFs.machineConfigure.optionList().subscribe({next:t=>{t.code==="OK"&&(this.machineList=t.data||[])},error:t=>{console.error("Error fetching machine list:",t)}})}currentPage=1;pageSize=10;totalEntries=0;onPageChange(t){this.currentPage=t,this.loadList()}onEntriesPerPageChange(t){let e=t;e&&e>0&&(this.currentPage=1,this.pageSize=e,this.onPageChange(this.currentPage))}loadList(){let t={};this.pageSize&&this.pageSize>0&&Object.assign(t,{limit:this.pageSize}),this.currentPage&&this.currentPage>0&&Object.assign(t,{page:this.currentPage}),this._apiFs.partsChangeEntry.listPagination(t).subscribe({next:e=>{e.code==="OK"&&(this.partChangeList=e.data.partChangeLogs,this.filteredPartChangeList=[...this.partChangeList],this.totalEntries=e.data.totalCount??0,this.filterPartChangeList=[],this.filteredFilterPartChangeList=[],this.cacheFilterPartChangeList=[],this.isAllFilterSelected=!1,this.cacheSearchTerm="")},error:e=>{}})}onOpenUpsertPartChangeModal(t=null){this.upsertPartsChangeEntryModalData=t,this.isUpsertPartsChangeEntryModalOpen=!0}onClosePartChangeModal(){this.isUpsertPartsChangeEntryModalOpen=!1}upsertPartChangeModalEvent(t){this.loadList(),this.onClosePartChangeModal()}filterPartChangeList=[];filteredFilterPartChangeList=[];cacheFilterPartChangeList=[];isAllFilterSelected=!1;onSearchTerms(t){this.cacheSearchTerm=t,t=t?.trim()?.toLowerCase()||"",this.filteredFilterPartChangeList=this.filterPartChangeList.filter(e=>{let r=e.machineName?.trim()?.toLowerCase()||"";return(e.machineCode?.trim()?.toLowerCase()||"").includes(t)||r.includes(t)}),this.updateAllSelectedFlag()}onOpenFilterPopup(){let t=new Map;this.partChangeList.forEach(({machineId:e})=>{if(e){let r=`${e.machineName}-${e.machineCode}`;r!=="-"&&!t.has(r)&&t.set(r,e)}}),!this.filterPartChangeList.length&&this.filterPartChangeList.length!==t.size&&(this.filterPartChangeList=Array.from(t.values()),this.filteredFilterPartChangeList=this.filterPartChangeList),this.cacheFilterPartChangeList=JSON.parse(JSON.stringify(this.filterPartChangeList)),this.toggleFilterPopup=!0}onToggleSelectAllFilters(){this.isAllFilterSelected=!this.isAllFilterSelected,this.filteredFilterPartChangeList.forEach(t=>{t.selected=this.isAllFilterSelected})}updateAllSelectedFlag(){this.isAllFilterSelected=this.filteredFilterPartChangeList.length>0&&this.filteredFilterPartChangeList.every(t=>t.selected)}onFilterSelectionChange(){this.updateAllSelectedFlag()}onApplyFilterPopup(){this.toggleFilterPopup=!1;let t=new Set(this.filterPartChangeList.filter(e=>e.selected).map(e=>e._id));this.filteredPartChangeList=t.size?this.partChangeList.filter(e=>t.has(e?.machineId?._id)):[...this.partChangeList]}onCloseOrCancelFilterPopup(){this.toggleFilterPopup=!1,this.filterPartChangeList=JSON.parse(JSON.stringify(this.cacheFilterPartChangeList)),this.onSearchTerms("")}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=E({type:n,selectors:[["app-parts-change-entry"]],decls:42,vars:7,consts:[[1,"container-xxl","p-3","my-4","bg-white","shadow-sm","rounded-2","border"],[1,"table-responsive"],[1,"table","caption-top","table-striped","table-hover"],[1,"d-flex","align-items-center","justify-content-between","gap-2","flex-wrap"],[1,"d-flex","align-items-center","gap-2","column-gap-3"],[1,"text-capitialise","fs-5"],["selectClass","form-select-sm",3,"pageSizeChange","pageSize"],[1,"d-flex","align-items-center","gap-2","flex-wrap"],[1,"btn","btn-outline-secondary","btn-sm","d-flex","align-items-center","gap-1",3,"click"],["height","18","width","18","viewBox","0 0 48 48",1,"flex-shrink-0"],["fill","none","stroke","currentColor","stroke-miterlimit","10","stroke-width","4","points","6,10 42,10 28,26 28,38 20,42 20,26 "],[1,"text-nowrap"],[1,"btn","btn-outline-primary","btn-sm","d-flex","align-items-center","gap-1",3,"click"],["fill","none","stroke","currentColor","stroke-miterlimit","10","stroke-width","4","stroke-linecap","round","x1","8","x2","40","y1","24","y2","24"],["fill","none","stroke","currentColor","stroke-miterlimit","10","stroke-width","4","stroke-linecap","round","x1","24","x2","24","y1","8","y2","40"],[1,"table-dark","bg-opacity-50"],["scope","col",1,"w-1-percent"],["scope","col",1,"text-nowrap"],["scope","col"],[1,"d-block",3,"pageChange","pageSize","totalEntries","currentPage"],[3,"machineList","partNameList","pceData"],[1,"modal","d-block"],["scope","row"],[1,"text-capitalize"],[1,"lh-1","mb-1"],[1,"small","lh-1","text-muted"],[1,"btn","btn-outline-primary","btn-sm",3,"click"],["colspan","6",1,"text-muted","small","text-center"],[3,"close","upsert","machineList","partNameList","pceData"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content","shadow-lg"],[1,"modal-header"],[1,"modal-title","fs-5"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["placeholder","Search by Name or Code",1,"d-block","border","border-1","rounded-2","overflow-hidden","mb-4",3,"onSearch","searchTerms"],[1,"d-flex","align-items-center","gap-2","user-select-none","mb-3"],["type","checkbox","id","selectAllMachines",1,"form-check-input","m-0","fs-4",3,"click","checked"],["for","selectAllMachines",1,"form-check-label","w-100"],[1,"text-capitalize","text-dark"],[1,"overflow-auto","adjust-list-wrap","d-flex","flex-wrap","gap-2"],[1,"d-flex","align-items-center","gap-2","user-select-none"],[1,"flex-grow-1","text-center","text-muted","small"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary","me-3",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["type","checkbox",1,"form-check-input","m-0","fs-5",3,"ngModelChange","id","checked","ngModel"],[1,"form-check-label","w-100",3,"for"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"div",1)(2,"table",2)(3,"caption")(4,"div",3)(5,"div",4)(6,"strong",5),o(7," Machine Parts "),a(),i(8,"app-entries-per-page-selector",6),u("pageSizeChange",function(p){return r.onEntriesPerPageChange(p)}),a()(),i(9,"div",7)(10,"button",8),u("click",function(){return r.onOpenFilterPopup()}),W(),i(11,"svg",9),x(12,"polygon",10),a(),Y(),i(13,"span",11),o(14," Filters "),a()(),i(15,"button",12),u("click",function(){return r.onOpenUpsertPartChangeModal()}),W(),i(16,"svg",9),x(17,"line",13)(18,"line",14),a(),Y(),i(19,"span",11),o(20," New Machine Part "),a()()()()(),i(21,"thead",15)(22,"tr")(23,"th",16),o(24,"#"),a(),i(25,"th",17),o(26," Part Name "),a(),i(27,"th",18),o(28," Machine "),a(),i(29,"th",17),o(30," Changed On "),a(),i(31,"th",17),o(32," Changed By "),a(),i(33,"th",16),o(34," Action "),a()()(),i(35,"tbody"),b(36,sn,17,10,"tr",null,on,!1,cn,3,0,"tr"),a()()(),i(39,"app-pagination",19),u("pageChange",function(p){return r.onPageChange(p)}),a()(),d(40,dn,1,3,"app-upsert-parts-change-entry",20),d(41,un,23,3,"div",21)),e&2&&(l(8),v("pageSize",r.pageSize),l(28),S(r.filteredPartChangeList),l(3),v("pageSize",r.pageSize)("totalEntries",r.totalEntries)("currentPage",r.currentPage),l(),m(r.isUpsertPartsChangeEntryModalOpen?40:-1),l(),m(r.toggleFilterPopup?41:-1))},dependencies:[oe,_e,D,fe,Be,qe,Re,Ee,ne],styles:[".adjust-list-wrap[_ngcontent-%COMP%]{margin:-.5em -1em;padding:.5em .5em .5em 1em;max-height:60vh}"]})};function hn(n,t){n&1&&(i(0,"span"),o(1,"Fullname is required."),a())}function _n(n,t){if(n&1&&(i(0,"span"),o(1),a()),n&2){let e=c(2);l(),h(" fullname cannot exceed ",e.fullname==null||e.fullname.errors==null||e.fullname.errors.maxlength==null?null:e.fullname.errors.maxlength.requiredLength," characters. ")}}function fn(n,t){if(n&1&&(i(0,"div",13),d(1,hn,2,0,"span"),d(2,_n,2,1,"span"),a()),n&2){let e=c();l(),m(!(e.fullname==null||e.fullname.errors==null)&&e.fullname.errors.required?1:-1),l(),m(!(e.fullname==null||e.fullname.errors==null)&&e.fullname.errors.maxlength?2:-1)}}function gn(n,t){n&1&&(i(0,"span"),o(1,"User name is required."),a())}function Cn(n,t){if(n&1&&(i(0,"span"),o(1),a()),n&2){let e=c(2);l(),h(" User name cannot exceed ",e.userName==null||e.userName.errors==null||e.userName.errors.maxlength==null?null:e.userName.errors.maxlength.requiredLength," characters. ")}}function xn(n,t){if(n&1&&(i(0,"div",13),d(1,gn,2,0,"span"),d(2,Cn,2,1,"span"),a()),n&2){let e=c();l(),m(!(e.userName==null||e.userName.errors==null)&&e.userName.errors.required?1:-1),l(),m(!(e.userName==null||e.userName.errors==null)&&e.userName.errors.maxlength?2:-1)}}function vn(n,t){n&1&&(i(0,"span"),o(1,"Password is required."),a())}function yn(n,t){if(n&1&&(i(0,"span"),o(1),a()),n&2){let e=c(2);l(),h(" Password must be at least ",e.password==null||e.password.errors==null||e.password.errors.minlength==null?null:e.password.errors.minlength.requiredLength," characters long. ")}}function bn(n,t){if(n&1&&(i(0,"span"),o(1),a()),n&2){let e=c(2);l(),h(" Password cannot exceed ",e.password==null||e.password.errors==null||e.password.errors.maxlength==null?null:e.password.errors.maxlength.requiredLength," characters. ")}}function Sn(n,t){if(n&1&&(i(0,"div",13),d(1,vn,2,0,"span"),d(2,yn,2,1,"span"),d(3,bn,2,1,"span"),a()),n&2){let e=c();l(),m(!(e.password==null||e.password.errors==null)&&e.password.errors.required?1:-1),l(),m(!(e.password==null||e.password.errors==null)&&e.password.errors.minlength?2:-1),l(),m(!(e.password==null||e.password.errors==null)&&e.password.errors.maxlength?3:-1)}}function En(n,t){n&1&&(i(0,"span"),o(1,"Mobile number is required."),a())}function Mn(n,t){n&1&&(i(0,"span"),o(1,"Enter a valid 10-digit mobile number."),a())}function wn(n,t){if(n&1&&(i(0,"div",13),d(1,En,2,0,"span"),d(2,Mn,2,0,"span"),a()),n&2){let e=c();l(),m(!(e.mobile==null||e.mobile.errors==null)&&e.mobile.errors.required?1:-1),l(),m(!(e.mobile==null||e.mobile.errors==null)&&e.mobile.errors.pattern?2:-1)}}function Nn(n,t){n&1&&(i(0,"span"),o(1,"Email is required."),a())}function Tn(n,t){n&1&&(i(0,"span"),o(1,"Enter a valid email address."),a())}function kn(n,t){if(n&1&&(i(0,"div",13),d(1,Nn,2,0,"span"),d(2,Tn,2,0,"span"),a()),n&2){let e=c();l(),m(!(e.email==null||e.email.errors==null)&&e.email.errors.required?1:-1),l(),m(!(e.email==null||e.email.errors==null)&&e.email.errors.email?2:-1)}}function Fn(n,t){if(n&1&&(i(0,"div",28)(1,"div",32),x(2,"input",33),i(3,"label",34),o(4," Is Active "),a()()()),n&2){let e=c();l(2),v("checked",e.isActive==null?null:e.isActive.value)}}var we=class n{_coreService=C(M);_apiFs=C(w);_fb=C(A);userData=null;closeOrCancel=new z;upsert=new z;isEditMode=!1;userForm=this._fb.group({fullname:["",[g.required,g.maxLength(100)]],userName:["",[g.required]],password:["",[g.required,g.minLength(6),g.maxLength(20)]],mobile:["",[g.pattern("^[0-9]{10}$")]],email:["",[g.email]],isActive:[!0,[]]});isEyeOpen=!1;ngOnChanges(t){t.userData?.currentValue&&(this.isEditMode=!0,this.userData?.isCurrentUser&&this.userForm.removeControl("isActive"),this.password?.setValidators([g.minLength(6),g.maxLength(20)]),this.userForm.patchValue({fullname:this.userData.fullname||"",userName:this.userData.userName||"",mobile:this.userData.mobile||"",email:this.userData.email||"",isActive:this.userData.isActive??!0}))}get fullname(){return this.userForm.get("fullname")}get userName(){return this.userForm.get("userName")}get mobile(){return this.userForm.get("mobile")}get email(){return this.userForm.get("email")}get password(){return this.userForm.get("password")}get isActive(){return this.userForm.get("isActive")}onlyDigits(t,e=10){let r=t.target;["Backspace","Tab","ArrowLeft","ArrowRight","Delete","Enter"].includes(t.key)||(!/^\d$/.test(t.key)||r.value.length>=e)&&t.preventDefault()}isReqAlive=!1;onSubmit(){if(this.isReqAlive)return;if(this.userForm.invalid){this.userForm.markAllAsTouched();return}let t={fullname:this.fullname?.value?.trim(),userName:this.userName?.value?.trim(),mobile:this.mobile?.value?.trim(),email:this.email?.value?.trim(),password:this.password?.value?.trim()};this.isActive&&(t.isActive=this.isActive?.value),this.isReqAlive=!0,this.isEditMode?(t.password||delete t.password,this._apiFs.users.update(this.userData._id,t).subscribe({next:e=>{this.isReqAlive=!1,e.code==="OK"&&(this._coreService.utils.showToaster("success","User updated successfully."),this.upsert.emit(e.data))},error:e=>{this.isReqAlive=!1;let r=e?.error?.message||"Something went wrong, please try again later.";this._coreService.utils.showToaster("danger",r)}})):this._apiFs.users.create(t).subscribe({next:e=>{this.isReqAlive=!1,e.code==="CREATED"&&(this._coreService.utils.showToaster("success","User created successfully."),this.upsert.emit(!0))},error:e=>{this.isReqAlive=!1;let r=e?.error?.message||"Something went wrong, please try again later.";this._coreService.utils.showToaster("danger",r)}})}onCloseOrCancel(){this.closeOrCancel.emit()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=E({type:n,selectors:[["app-upsert-user"]],inputs:{userData:"userData"},outputs:{closeOrCancel:"closeOrCancel",upsert:"upsert"},features:[Z],decls:53,vars:14,consts:[[1,"modal","modal-lg","fade","show","d-block"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content","shadow-lg"],[3,"ngSubmit","formGroup"],[1,"modal-header"],[1,"modal-title","fs-5"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"row"],[1,"col-12","col-md-6","mb-3"],["for","fullname",1,"form-label"],[1,"text-danger"],["type","text","id","fullname","formControlName","fullname","placeholder","Enter fullname",1,"form-control"],[1,"invalid-feedback","d-block"],["for","userName",1,"form-label"],["type","text","id","userName","formControlName","userName","placeholder","Enter user name/mobile",1,"form-control"],["for","password",1,"form-label"],[1,"input-group","flex-nowrap"],["id","password","formControlName","password","maxlength","20","placeholder","Enter your password","aria-describedby","password",1,"form-control",3,"type"],[1,"input-group-text","user-select-none","position-relative","cursor-pointer",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","#737373"],["d","M12 9a3.02 3.02 0 0 0-3 3c0 1.642 1.358 3 3 3s3-1.358 3-3-1.359-3-3-3"],["d","M12 5c-7.633 0-9.927 6.617-9.948 6.684L1.946 12l.105.316C2.073 12.383 4.367 19 12 19s9.927-6.617 9.948-6.684l.106-.316-.105-.316C21.927 11.617 19.633 5 12 5m0 12c-5.351 0-7.424-3.846-7.926-5C4.578 10.842 6.652 7 12 7c5.351 0 7.424 3.846 7.926 5-.504 1.158-2.578 5-7.926 5"],[1,"password-eye-line"],["for","mobile",1,"form-label"],["type","text","id","mobile","formControlName","mobile","placeholder","Enter mobile number",1,"form-control",3,"keypress"],["for","email",1,"form-label"],["type","email","id","email","formControlName","email","placeholder","Enter email",1,"form-control"],[1,"col-12","col-md-6","mb-3","d-flex"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary","me-3",3,"click"],[1,"btn","btn-primary"],[1,"form-check","form-switch","my-auto"],["type","checkbox","id","isActive","formControlName","isActive",1,"form-check-input",3,"checked"],["for","isActive",1,"form-check-label"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3),u("ngSubmit",function(){return r.onSubmit()}),i(4,"div",4)(5,"h1",5),o(6),a(),i(7,"button",6),u("click",function(){return r.onCloseOrCancel()}),a()(),i(8,"div",7)(9,"div",8)(10,"div",9)(11,"label",10),o(12," Full Name "),i(13,"span",11),o(14,"*"),a()(),x(15,"input",12),d(16,fn,3,2,"div",13),a(),i(17,"div",9)(18,"label",14),o(19," User Name "),i(20,"span",11),o(21,"*"),a()(),x(22,"input",15),d(23,xn,3,2,"div",13),a(),i(24,"div",9)(25,"label",16),o(26," Password "),i(27,"span",11),o(28,"*"),a()(),i(29,"div",17),x(30,"input",18),i(31,"span",19),u("click",function(){return r.isEyeOpen=!r.isEyeOpen}),W(),i(32,"svg",20),x(33,"path",21)(34,"path",22),a(),Y(),x(35,"span",23),a()(),d(36,Sn,4,3,"div",13),a(),i(37,"div",9)(38,"label",24),o(39," Mobile Number "),a(),i(40,"input",25),u("keypress",function(p){return r.onlyDigits(p)}),a(),d(41,wn,3,2,"div",13),a(),i(42,"div",9)(43,"label",26),o(44," Email "),a(),x(45,"input",27),d(46,kn,3,2,"div",13),a(),d(47,Fn,5,1,"div",28),a()(),i(48,"div",29)(49,"button",30),u("click",function(){return r.onCloseOrCancel()}),o(50," Cancel "),a(),i(51,"button",31),o(52),a()()()()()()),e&2&&(l(3),v("formGroup",r.userForm),l(3),h(" ",r.isEditMode?"Edit User":"Create User"," "),l(10),m(r.fullname!=null&&r.fullname.touched&&(r.fullname!=null&&r.fullname.errors)?16:-1),l(7),m(r.userName!=null&&r.userName.touched&&(r.userName!=null&&r.userName.errors)?23:-1),l(4),L("d-none",r.isEditMode),l(3),v("type",r.isEyeOpen?"text":"password"),l(5),L("hide",r.isEyeOpen),l(),m(r.password!=null&&r.password.touched&&(r.password!=null&&r.password.errors)?36:-1),l(5),m(r.mobile!=null&&r.mobile.touched&&(r.mobile!=null&&r.mobile.errors)?41:-1),l(5),m(r.email!=null&&r.email.touched&&(r.email!=null&&r.email.errors)?46:-1),l(),m(r.userForm.contains("isActive")?47:-1),l(5),h(" ",r.isEditMode?"Update":"Create"," "))},dependencies:[V,B,P,_e,D,U,Ge,O,G],styles:[".password-eye-line[_ngcontent-%COMP%]{position:absolute;display:block;width:2px;height:60%;background:#737373;transform:rotate(315deg);left:50%;top:20%}.password-eye-line.hide[_ngcontent-%COMP%]{display:none}"]})};var Dn=(n,t)=>t._id;function An(n,t){if(n&1){let e=y();i(0,"button",12),u("click",function(){_(e);let s=c();return f(s.onOpenUpsertUserModal())}),W(),i(1,"svg",13),x(2,"line",14)(3,"line",15),a(),Y(),i(4,"span",16),o(5,"New User"),a()()}}function In(n,t){n&1&&(i(0,"span",20),o(1," Current User "),a())}function Ln(n,t){if(n&1){let e=y();i(0,"div",21)(1,"input",23),u("click",function(s){_(e);let p=c().$implicit,F=c();return f(F.onStatusChange(s,p))}),a()()}if(n&2){let e=c().$implicit;l(),v("checked",e==null?null:e.isActive)}}function Pn(n,t){if(n&1){let e=y();i(0,"tr")(1,"th",17),o(2),a(),i(3,"td",18),o(4),a(),i(5,"td"),o(6),a(),i(7,"td"),o(8),a(),i(9,"td"),o(10),a(),i(11,"td",19),d(12,In,2,0,"span",20)(13,Ln,2,1,"div",21),a(),i(14,"td",16)(15,"button",22),u("click",function(){let s=_(e).$implicit,p=c();return f(p.onOpenUpsertUserModal(s))}),o(16," Edit "),a()()()}if(n&2){let e=t.$implicit,r=t.$index;l(2),k(r+1),l(2),k(e.fullname||"-"),l(2),k(e==null?null:e.userName),l(2),k((e==null?null:e.mobile)||"-"),l(2),k((e==null?null:e.email)||"-"),l(2),m(e!=null&&e.isCurrentUser?12:13)}}function Un(n,t){n&1&&(i(0,"tr")(1,"td",24),o(2,"No users found."),a()())}function On(n,t){if(n&1){let e=y();i(0,"app-upsert-user",25),u("closeOrCancel",function(){_(e);let s=c();return f(s.onCloseUserModal())})("upsert",function(s){_(e);let p=c();return f(p.upsertUserModalEvent(s))}),a()}if(n&2){let e=c();v("userData",e.upsertUserModalData)}}function Gn(n,t){if(n&1){let e=y();i(0,"div",11)(1,"div",26)(2,"div",27)(3,"div",28)(4,"h5",29),o(5,"Confirm Status Change"),a(),i(6,"button",30),u("click",function(){_(e);let s=c();return f(s.closeStatusChangeConfirmationModal())}),a()(),i(7,"div",31),o(8," Are you sure you want to "),i(9,"strong"),o(10),a(),o(11," the user("),i(12,"strong"),o(13),a(),o(14,")? "),a(),i(15,"div",32)(16,"button",33),u("click",function(){_(e);let s=c();return f(s.closeStatusChangeConfirmationModal())}),o(17," Cancel "),a(),i(18,"button",34),u("click",function(){_(e);let s=c();return f(s.confirmStatusChange())}),o(19," Confirm "),a()()()()()}if(n&2){let e=c();l(10),k(e.userStatusChangeData!=null&&e.userStatusChangeData.isActive?"deactivate":"activate"),l(3),k(e.userStatusChangeData==null?null:e.userStatusChangeData.userName)}}var Ne=class n{_apiFs=C(w);_coreService=C(M);userList=[];isUpsertUserModalOpen=!1;upsertUserModalData=null;ngOnInit(){this.loadList()}loadList(){this._apiFs.users.list().subscribe({next:t=>{if(t.code==="OK"){let e=this._coreService.utils.decodeToken?.user??{};this.userList=(t.data||[]).map(r=>Ae(R({},r),{isCurrentUser:e?.id===r._id}))}},error:t=>{}})}isStatusChangeConfirmationModalOpen=!1;userStatusChangeData=null;onStatusChange(t,e){t?.stopPropagation(),t?.preventDefault(),!e?.isCurrentUser&&(this.userStatusChangeData=R({},e),this.isStatusChangeConfirmationModalOpen=!0)}closeStatusChangeConfirmationModal(){this.isStatusChangeConfirmationModalOpen=!1,this.userStatusChangeData=null}isReqAlive=!1;confirmStatusChange(){if(this.isReqAlive||this.upsertUserModalData?.isCurrentUser)return;let t=this.userStatusChangeData?._id;if(!t)return;let e=this.userList.findIndex(r=>r._id===t);e!==-1&&(this.userList[e].isActive=!this.userList[e].isActive,this.closeStatusChangeConfirmationModal(),this.isReqAlive=!0,this._apiFs.users.update(t,{isActive:this.userList[e].isActive}).subscribe({next:r=>{this.isReqAlive=!1,r.code==="OK"&&this._coreService.utils.showToaster("success","User status updated successfully.")},error:r=>{this.isReqAlive=!1,this.userList[e].isActive=!this.userList[e].isActive;let s=r?.error?.message||"Something went wrong, please try again later.";this._coreService.utils.showToaster("danger",s)}}))}onOpenUpsertUserModal(t=null){this.upsertUserModalData=t,this.isUpsertUserModalOpen=!0}onCloseUserModal(){this.isUpsertUserModalOpen=!1,this.upsertUserModalData=null}upsertUserModalEvent(t){if(!t?._id)this.loadList();else{let e=this.userList.findIndex(r=>r._id===t._id);e!==-1&&(this.userList[e]=R(R({},this.userList[e]),t))}this.onCloseUserModal()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=E({type:n,selectors:[["app-users"]],decls:32,vars:4,consts:[[1,"container-xxl","p-3","my-4","bg-white","shadow-sm","rounded-2","border"],[1,"table-responsive"],[1,"table","table-hover","caption-top"],[1,"d-flex","justify-content-between","align-items-center","flex-wrap"],[1,"fs-5"],[1,"d-flex","align-items-center","gap-2"],[1,"btn","btn-outline-primary","btn-sm","d-flex","align-items-center","gap-2"],["scope","col"],["scope","col",1,"text-center","text-nowrap"],["scope","col",1,"w-1-percent","text-center"],[3,"userData"],[1,"modal","fade","show","d-block"],[1,"btn","btn-outline-primary","btn-sm","d-flex","align-items-center","gap-2",3,"click"],["height","20","width","20","viewBox","0 0 48 48",1,"flex-shrink-0"],["fill","none","stroke","currentColor","stroke-miterlimit","10","stroke-width","4","stroke-linecap","round","x1","8","x2","40","y1","24","y2","24"],["fill","none","stroke","currentColor","stroke-miterlimit","10","stroke-width","4","stroke-linecap","round","x1","24","x2","24","y1","8","y2","40"],[1,"text-nowrap"],["scope","row"],[1,"word-break-all"],[1,"text-center"],[1,"badge","bg-primary","rounded-2"],[1,"form-check","form-switch","d-flex","p-0"],[1,"btn","btn-sm","btn-outline-primary","me-2",3,"click"],["type","checkbox",1,"form-check-input","mx-auto","fs-5",3,"click","checked"],["colspan","9",1,"text-center"],[3,"closeOrCancel","upsert","userData"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content","shadow-lg"],[1,"modal-header"],["id","statusChangeModalLabel",1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"div",1)(2,"table",2)(3,"caption")(4,"div",3)(5,"div")(6,"strong",4),o(7," Users "),a()(),i(8,"div",5),d(9,An,6,0,"button",6),a()()(),i(10,"thead")(11,"tr")(12,"th",7),o(13,"#"),a(),i(14,"th",7),o(15,"Full Name"),a(),i(16,"th",7),o(17,"Username"),a(),i(18,"th",7),o(19,"Mobile"),a(),i(20,"th",7),o(21,"Email"),a(),i(22,"th",8),o(23,"Is Active"),a(),i(24,"th",9),o(25,"Actions"),a()()(),i(26,"tbody"),b(27,Pn,17,6,"tr",null,Dn,!1,Un,3,0,"tr"),a()()()(),d(30,On,1,1,"app-upsert-user",10),d(31,Gn,20,2,"div",11)),e&2&&(l(9),m(r._coreService.utils.isAdmin?9:-1),l(18),S(r.userList),l(3),m(r.isUpsertUserModalOpen?30:-1),l(),m(r.isStatusChangeConfirmationModalOpen?31:-1))},dependencies:[oe,we],encapsulation:2})};var $a=[{path:K.SETTINGS.MACHINE_GROUP,title:j.SETTINGS.MACHINE_GROUP,component:xe},{path:K.SETTINGS.MACHINE_CONFIGURE,title:j.SETTINGS.MACHINE_CONFIGURE,component:ve},{path:K.SETTINGS.MAINTENANCE_CATEGORY,title:j.SETTINGS.MAINTENANCE_CATEGORY,component:ye},{path:K.SETTINGS.MAINTENANCE_ENTRY,title:j.SETTINGS.MAINTENANCE_ENTRY,component:be},{path:K.SETTINGS.SHIFT_WISE_COMMENT_UPDATE,title:j.SETTINGS.SHIFT_WISE_COMMENT_UPDATE,component:Se},{path:K.SETTINGS.PARTS_CHANGE_ENTRY,title:j.SETTINGS.PARTS_CHANGE_ENTRY,component:Me},{path:K.SETTINGS.USERS,title:j.SETTINGS.USERS,component:Ne},{path:K.PAGE_NOT_FOUND,title:j.PAGE_NOT_FOUND,component:Ve}];export{$a as routes};
